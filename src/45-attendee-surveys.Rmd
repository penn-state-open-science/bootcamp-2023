# Attendee surveys {-}

This page summarizes the data collected from prospective and actual Bootcamp attendees.

```{r include=FALSE}
library('tidyverse')
library('ggplot2')
library('dplyr')
library('tidyr')
library('stringr')
library('lubridate')

options(gargle_oauth_email = "rick.o.gilmore@gmail.com")
googledrive::drive_auth()
```

<!-- ## Day 3, August 11, 2023 -->

<!-- ## Day 2, August  -->

<!-- ## Day 1, August 9, 2023 -->

## Registration - July 19, 2023 {-}

Render date: `r Sys.time()`

Survey link: <https://forms.gle/wPBr9XgXmmzhSszm7>

<iframe src="https://docs.google.com/forms/d/e/1FAIpQLScdIbP8TZrulVC01MQbtQN13iaW1WIjQx86f-wGOpC0F3bxBg/viewform?embedded=true" width="640" height="2489" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>

### Results {-}

Download.

```{r}
if (!dir.exists('csv')) {
  message("Creating missing `csv/`.")
  dir.create("csv")
}

googledrive::drive_download("Open Science Bootcamp 2023: Registration (Responses)", path = "csv/registrations-2023-07.csv", type = "csv", overwrite = TRUE)
```

Clean.

```{r}
registrations <-
  readr::read_csv("csv/registrations-2023-07.csv", show_col_types = FALSE)

reqistrations_qs <- names(registrations)

registrations_clean <- registrations |>
  dplyr::rename(
    timestamp = "Timestamp",
    confirmed = "Will you attend the Bootcamp on August 9-11, 2023?",
    name = "What is your name?",
    psu_email = "What is your PSU email?",
    dept= "What is your department or unit?",
    position = "What is your current position?",
    email = "Email Address",
    am_sess_1 = "Which of these sessions do you plan to attend?...8",
    am_sess_2 = "Which of these sessions do you plan to attend?...9",
    pm_sess_3 = "Which of these sessions do you plan to attend?...10",
    pm_sess_4 = "Which of these sessions do you plan to attend?...11",
    comments = "Any comments?"
  )

registrations_clean <- registrations_clean |>
  dplyr::mutate(timestamp = lubridate::mdy_hms(timestamp, tz = "America/New_York")) |>
  dplyr::arrange(timestamp) |>
  dplyr::select(-psu_email)

```

#### Registration numbers {-}

```{r}
registration_yes <- registrations_clean |> 
  dplyr::filter(confirmed == "Yes") 
```

As of `r Sys.time()`, we have $n=$ `r dim(registration_yes)[1]` confirmed attendees. That is `r round(100*dim(registration_yes)[1]/75, 1)` \% of our target registration/attendance limit of $n=75$, and includes the presenters.

#### Time series {-}

```{r registrations-timeseries, fig.cap = "Time series of registrations"}
registrations_clean |>
  dplyr::group_by(confirmed) |>
  dplyr::mutate(resp_index = seq_along(confirmed)) |>
  dplyr::ungroup() |>
  ggplot() +
  aes(x = timestamp, y = resp_index, color = confirmed) +
  geom_point() +
  geom_line() +
  facet_grid(~ confirmed) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = NULL, y = 'n') +
  scale_color_manual(breaks = c("No", "Yes"),
                        values=c("red", "green"))
```

#### By position {-}

```{r by-position, fig.cap="Registrations by position"}
registration_yes |>
  ggplot() +
  aes(x = position) +
  geom_bar() +
  coord_flip()
```

#### By Department & College {-}

```{r by-dept, fig.cap="Registrations by department and college"}
registration_yes <- registration_yes |>
  dplyr::mutate(
    dept = dplyr::recode(
      dept,
      `Clinical Psychology` = "Psychology",
      `Psychology / SSRI` = "Psychology",
      `Department of Psychology` = "Psychology",
      `Human Development and Family Studies & Social Data Analytics` = "HDFS",
      `RPTM`= "Recreation, Park, & Tourism Management",
      `Spanish Italian and portuguese` = "Spanish, Italian, & Portuguese",
      `Nutrition` = "Nutritional Sciences"
    )
  ) |>
  dplyr::mutate(college = case_match(dept,
                                     "Statistics" ~ "ECoS",
                                     "Psychology" ~ "CLA",
                                     "Spanish, Italian, & Portuguese" ~ "CLA",
                                     "Research Informatics and Publishing" ~ "Libraries",
                                     "Political Science" ~ "CLA",
                                     "Applied Linguistics" ~ "CLA",
                                     "IST" ~ "IST",
                                     "Engineering Science and Mechanics" ~ "Engineering",
                                     "Chemical Engineering" ~ "Engineering",
                                     "Material Science and Engineering" ~ "Engineering",
                                     "Nutritional Sciences" ~ "HHD",
                                     "HDFS" ~ "HHD",
                                     "Kinesiology" ~ "HHD",
                                     "Recreation, Park, & Tourism Management" ~ "HHD"),
                .default = "Unknown",
                .missing = "Unknown")

registration_yes |>
  ggplot() +
  aes(x = dept, fill = college) +
  geom_bar() +
  coord_flip()
```

```{r, include = FALSE}
xtabs(~ college, registration_yes)
```

#### [Thu AM Session 1](#day_2_am_session_1) {-}

```{r am_sess_1}
registration_yes |>
  dplyr::filter(!is.na(am_sess_1)) |>
  ggplot() +
  aes(x = am_sess_1) +
  geom_bar() +
  coord_flip()
```

#### [Thu AM Session 2](#day_2_am_session_2) {-}

```{r am_sess_2}
registration_yes |>
  dplyr::filter(!is.na(am_sess_2)) |>
  ggplot() +
  aes(x = am_sess_2) +
  geom_bar() +
  coord_flip()
```

#### [Thu PM Session 3](#day_2_pm_session_3) {-}

```{r pm_sess_3}
registration_yes |>
  dplyr::filter(!is.na(pm_sess_3)) |>
  ggplot() +
  aes(x = pm_sess_3) +
  geom_bar() +
  coord_flip()
```

#### [Thu PM Session 4](#day_2_pm_session_4) {-}

```{r pm_sess_4}
registration_yes |>
  dplyr::filter(!is.na(pm_sess_4)) |>
  ggplot() +
  aes(x = pm_sess_4) +
  geom_bar() +
  coord_flip()
```

#### Comments {-}

```{r}
registration_yes |>
  dplyr::select(comments) |>
  dplyr::filter(!is.na(comments)) |>
  knitr::kable(format = 'html') |>
  kableExtra::kable_material()
```

## Initial Interest - May 1, 2023 {-}

Render date: `r Sys.time()`

Survey link: <https://docs.google.com/forms/d/e/1FAIpQLSf_hIVQz3CoDq2bzjTNExw-Hn6uXLAf8ri4v8k5lRkifclxsQ/viewform?usp=sf_link>

<iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf_hIVQz3CoDq2bzjTNExw-Hn6uXLAf8ri4v8k5lRkifclxsQ/viewform?embedded=true" width="640" height="1321" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe>

### Results {-}

Download.

```{r}
if (!dir.exists('csv')) {
  message("Creating missing `csv/`.")
  dir.create("csv")
}

googledrive::drive_download("Open Science Bootcamp 2023 (Responses)", path = "csv/attendees-2023-05.csv", type = "csv", overwrite = TRUE)
```

Clean.

```{r}
attendees_1 <-
  readr::read_csv("csv/attendees-2023-05.csv", show_col_types = FALSE)

attendees_qs <- names(attendees_1)

attendees_1_clean <- attendees_1 |>
  dplyr::rename(
    timestamp = "Timestamp",
    interested = "Are you interested in and available to attend the August 9-11 Bootcamp?",
    name = "What is your name",
    email = "What is your PSU email?",
    interest_rmarkdown = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Intro to R/R Markdown/Quarto]",
    interest_jupyter = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Intro to Jupyter Notebooks]",
    interest_git = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Version control with git and GitHub]",
    interest_prereg = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Preregistration and registered reports]",
    interest_open_access = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Open Access Publishing]",
    interest_data_mgmt = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Data Management Plans]",
    interest_data_sharing = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Where to share data]",
    interest_repro_software = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Reproducible software]",
    interest_early_career = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Open science for early career researchers]",
    interest_qrp = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [Questionable research practices and how to avoid them]",
    interest_replication = "Please indicate your level of interest in attending a hands-on workshop on the following topics. [How to conduct and publish replication studies]",
    interest_other = "Are there topics not listed above that you would like to have considered?"
  )

attendees_1_clean <- attendees_1_clean |>
  dplyr::mutate(timestamp = lubridate::mdy_hms(timestamp, tz = "America/New_York"))
```

### Visualize {-}

```{r survey-1-timeseries, fig.cap = "Time series of responses"}
attendees_1_clean |>
  dplyr::group_by(interested) |>
  dplyr::mutate(resp_index = seq_along(interested)) |>
  dplyr::ungroup() |>
  ggplot() +
  aes(x = timestamp, y = resp_index, color = interested) +
  geom_point() +
  geom_line() +
  facet_grid(~ interested) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = NULL, y = 'n') +
  scale_color_manual(breaks = c("No", "Maybe", "Yes"),
                        values=c("red", "blue", "green"))
```

```{r}
# Define helper function for ordered factor
recode_low_med_high <- function(x) {
  factor(
    x,
    levels = c("Low interest", "Medium interest", "High interest"),
    labels = c("low", "med", "high"),
    ordered = TRUE
  )
}

recode_interest_score <- function(df) {
  df <- dplyr::mutate(df,
                     interest_score = case_match(interest_level,
                                                 "high" ~ 3,
                                                 "med" ~ 2,
                                                 "low" ~ 1))
  df
}
```

```{r}
# Transform interests
attendees_1_interests <- attendees_1_clean |>
  select(-interest_other) |>
  pivot_longer(
    cols = contains("interest_"),
    names_to = "topic",
    values_to = "interest_level"
  ) |>
  mutate(interest_level = recode_low_med_high(interest_level)) |>
  mutate(topic = str_remove_all(topic, "interest_")) |>
  filter(!is.na(interest_level)) |>
  recode_interest_score() |>
  group_by(topic) |> 
  mutate(mean_interest = round(mean(interest_score), 2)) |>
  ungroup()
```

```{r survey-1-interests, fig.cap="Expressed levels of interest for workshop topics"}
attendees_1_interests |>
  ggplot2::ggplot() +
  aes(x = interest_level, fill = interest_level, label = mean_interest) +
  geom_bar(na.rm = TRUE) +
  facet_wrap(~ topic) + 
  geom_text(x = 1, y = 30) + # This is not the best way to do this.
  theme(axis.text.x = element_blank()) +
  labs(x = NULL, y = 'n')
```

Other suggestions:

```{r, fig.cap="Other topic suggestions"}
attendees_1_clean |>
  dplyr::select(interest_other) |>
  dplyr::filter(!is.na(interest_other)) |>
  knitr::kable(format = 'html') |>
  kableExtra::kable_material()
```

### Extract emails for registration invitation {-}

::: {.rmdnote}

**NOTE**: All identifiable information is prevented from being publicly shared by adding the `src/csv/` data folder to our `src/.gitignore` file.

:::

```{r}
# Select and save first...
attendees_1_clean |>
  dplyr::filter(interested %in% c("Yes", "Maybe")) |>
  dplyr::select(email) |>
  readr::write_csv("csv/prereg-emails.csv")

# Then reimport and process via tempfile
prereg <- readr::read_csv("csv/prereg-emails.csv", show_col_types = FALSE)
tf <- (tempfile(fileext = ".txt"))
prereg_em <- file(tf, "w")
writeLines(con = tf, as.character(prereg$email), sep = ",")
close(prereg_em)
message(tf)
```

